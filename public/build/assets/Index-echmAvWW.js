import{r as l,j as e,Q as se,S as E,a as ae}from"./app-CYR8_A6n.js";import{A as te}from"./AdminAuthenticatedLayout-CTe1OmT7.js";import{t as T}from"./index-3hBDnU-Q.js";import{B as N}from"./button-DApKdSMh.js";import{C as I,a as re,b as le,d as P}from"./card-XqDTxpKX.js";import{B as h}from"./badge-B-fTs8Av.js";import{I as ie}from"./input-DuHn3Mx5.js";import{L as v}from"./label-Bxegxtut.js";import{S as A,a as U,b as F,c as D,d as n}from"./select-Dbmz7lev.js";import{D as ce,b as ne,c as de,d as oe,e as me,f as xe}from"./dialog-Drskh3pe.js";import{T as he,a as je,b as V,c as o,d as fe,e as m}from"./table-CtJjXJau.js";import{C as H}from"./checkbox-BMq_hxO0.js";import{A as p}from"./award-DbQqVMFm.js";import{F as pe}from"./file-text-CbLqUZsf.js";import{U as M}from"./index-BsODw5XB.js";import{L as Q}from"./loader-circle-CQE9RCf1.js";import{C as ue}from"./circle-check-big-D-oSvNkr.js";import{C as ge}from"./circle-alert-_1E_HZ7F.js";import"./index-DGq-kHDD.js";import"./index-B7R5Yj8X.js";import"./index-BYA3paII.js";import"./clsx-B-dksMZM.js";import"./index-CGNTSBfd.js";import"./breadcrumb-CoIzsEt5.js";import"./createLucideIcon-BAJcpCsp.js";import"./index-CnRWoKZx.js";import"./index-CxNRSp3h.js";import"./chevron-right-BhHhgun0.js";import"./avatar-Dp9IZtzi.js";import"./calendar-ByQlL5X-.js";import"./index-BdQq_4o_.js";import"./index-DeNuz5rL.js";function Ze({auth:R,templates:i,certificateTypes:Ne,departments:y,sessions:b}){const[c,$]=l.useState(null),[C,w]=l.useState(!1),[u,O]=l.useState([]),[x,j]=l.useState([]),[S,q]=l.useState([]),[k,G]=l.useState(!1),[_,L]=l.useState(!1),[ve,z]=l.useState({}),[r,J]=l.useState({department:"all",session:"all",usertype:"all",search:""}),K=async(s=1)=>{if(c){G(!0);try{const a={department:r.department==="all"?"":r.department,session:r.session==="all"?"":r.session,usertype:r.usertype==="all"?"":r.usertype,search:r.search},t=await ae.get(route("admin.certificate.generate.users"),{params:{...a,template_id:c.id,page:s}});O(t.data.users.data),z(t.data.users),q(t.data.existing_certificates)}catch{T.error("Failed to fetch users")}finally{G(!1)}}};l.useEffect(()=>{c&&C&&K()},[c,C,r]);const B=s=>{$(s),j([]),w(!0)},W=(s,a)=>{j(a?[...x,s]:x.filter(t=>t!==s))},X=s=>{if(s){const a=u.filter(t=>!S.includes(t.id));j(a.map(t=>t.id))}else j([])},Y=async()=>{if(x.length===0){T.error("Please select at least one user");return}L(!0);try{E.post(route("admin.certificate.generate.certificates"),{template_id:c.id,user_ids:x})}catch{T.error("Failed to generate certificates")}finally{L(!1)}},g=(s,a)=>{J(t=>({...t,[s]:a}))},Z=u.filter(s=>!S.includes(s.id)),d=x.length,f=Z.length;return e.jsxs(te,{user:R.user,children:[e.jsx(se,{title:"Generate Certificates"}),e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Generate Certificates"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create and distribute certificates to users"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(h,{variant:"outline",className:"flex items-center space-x-1",children:[e.jsx(p,{className:"w-4 h-4"}),e.jsxs("span",{children:[(i==null?void 0:i.length)||0," Templates"]})]})})]})}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Select Certificate Template"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:i==null?void 0:i.map(s=>{var a;return e.jsxs(I,{className:"cursor-pointer hover:shadow-lg transition-all duration-200 border-2 hover:border-blue-500",onClick:()=>B(s),children:[e.jsx(re,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(le,{className:"text-base font-semibold text-gray-900 line-clamp-2",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:(a=s.type)==null?void 0:a.name})]}),e.jsx(h,{variant:s.status===1?"default":"secondary",className:"ml-2",children:s.status===1?"Active":"Inactive"})]})}),e.jsxs(P,{className:"pt-0",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:s.layout===1?"Portrait":s.layout===2?"Landscape":"Custom"})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),e.jsxs("span",{children:[s.generated_certificates_count||0," Generated"]})]}),s.background_image&&e.jsx("div",{className:"mt-3",children:e.jsx("img",{src:`/storage/${s.background_image}`,alt:"Template preview",className:"w-full h-20 object-cover rounded border"})})]}),e.jsxs(N,{className:"w-full mt-4",onClick:t=>{t.stopPropagation(),B(s)},children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),"Generate Certificates"]})]})]},s.id)})}),(!i||i.length===0)&&e.jsx(I,{className:"text-center py-12",children:e.jsxs(P,{children:[e.jsx(p,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Templates Available"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Create certificate templates first to generate certificates."}),e.jsx(N,{onClick:()=>E.visit(route("admin.certificate.templates.create")),children:"Create Template"})]})})]})})}),e.jsx(ce,{open:C,onOpenChange:w,children:e.jsxs(ne,{className:"max-w-6xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs(de,{children:[e.jsxs(oe,{className:"flex items-center space-x-2",children:[e.jsx(p,{className:"w-5 h-5"}),e.jsxs("span",{children:["Generate Certificates - ",c==null?void 0:c.name]})]}),e.jsx(me,{children:"Select users to generate certificates for. Users who already have certificates for this template are disabled."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 py-4 border-b",children:[e.jsxs("div",{children:[e.jsx(v,{htmlFor:"search",children:"Search"}),e.jsx(ie,{id:"search",placeholder:"Search by name, email, or member ID...",value:r.search,onChange:s=>g("search",s.target.value),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"department",children:"Department"}),e.jsxs(A,{value:r.department,onValueChange:s=>g("department",s==="all"?"":s),children:[e.jsx(U,{className:"mt-1",children:e.jsx(F,{placeholder:"All Departments"})}),e.jsxs(D,{children:[e.jsx(n,{value:"all",children:"All Departments"}),y==null?void 0:y.filter(s=>s&&s.trim()!=="").map(s=>e.jsx(n,{value:s,children:s},s))]})]})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"session",children:"Session"}),e.jsxs(A,{value:r.session,onValueChange:s=>g("session",s==="all"?"":s),children:[e.jsx(U,{className:"mt-1",children:e.jsx(F,{placeholder:"All Sessions"})}),e.jsxs(D,{children:[e.jsx(n,{value:"all",children:"All Sessions"}),b==null?void 0:b.filter(s=>s&&s.trim()!=="").map(s=>e.jsx(n,{value:s,children:s},s))]})]})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"usertype",children:"User Type"}),e.jsxs(A,{value:r.usertype,onValueChange:s=>g("usertype",s==="all"?"":s),children:[e.jsx(U,{className:"mt-1",children:e.jsx(F,{placeholder:"All Types"})}),e.jsxs(D,{children:[e.jsx(n,{value:"all",children:"All Types"}),e.jsx(n,{value:"member",children:"Member"}),e.jsx(n,{value:"volunteer",children:"Volunteer"}),e.jsx(n,{value:"executive",children:"Executive"})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 bg-gray-50 px-4 rounded",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(H,{checked:d===f&&f>0,onCheckedChange:X,disabled:f===0}),e.jsxs("span",{className:"text-sm font-medium",children:["Select All Available (",f," users)"]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[d," of ",f," selected"]})]}),e.jsxs("div",{className:"flex-1 overflow-auto",children:[k?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(Q,{className:"w-8 h-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading users..."})]}):e.jsxs(he,{children:[e.jsx(je,{children:e.jsxs(V,{children:[e.jsx(o,{className:"w-12",children:"Select"}),e.jsx(o,{children:"User"}),e.jsx(o,{children:"Member ID"}),e.jsx(o,{children:"Department"}),e.jsx(o,{children:"Session"}),e.jsx(o,{children:"Type"}),e.jsx(o,{children:"Status"})]})}),e.jsx(fe,{children:u.map(s=>{const a=S.includes(s.id),t=x.includes(s.id);return e.jsxs(V,{className:a?"opacity-50":"",children:[e.jsx(m,{children:e.jsx(H,{checked:t,onCheckedChange:ee=>W(s.id,ee),disabled:a})}),e.jsx(m,{children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center",children:s.image?e.jsx("img",{src:`/storage/${s.image}`,alt:s.name,className:"w-8 h-8 rounded-full object-cover"}):e.jsx("span",{className:"text-xs font-medium text-gray-600",children:s.name.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.name}),e.jsx("div",{className:"text-sm text-gray-600",children:s.email})]})]})}),e.jsx(m,{className:"font-mono text-sm",children:s.member_id||"-"}),e.jsx(m,{children:e.jsx(h,{variant:"outline",children:s.department||"-"})}),e.jsx(m,{children:s.session||"-"}),e.jsx(m,{children:e.jsx(h,{variant:s.usertype==="member"?"default":"secondary",children:s.usertype||"-"})}),e.jsx(m,{children:a?e.jsxs(h,{variant:"secondary",className:"flex items-center space-x-1",children:[e.jsx(ue,{className:"w-3 h-3"}),e.jsx("span",{children:"Generated"})]}):e.jsxs(h,{variant:"outline",className:"flex items-center space-x-1",children:[e.jsx(ge,{className:"w-3 h-3"}),e.jsx("span",{children:"Pending"})]})})]},s.id)})})]}),!k&&u.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(M,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Users Found"}),e.jsx("p",{className:"text-gray-600",children:"Try adjusting your filters to find users."})]})]}),e.jsx(xe,{className:"border-t pt-4",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[d," user",d!==1?"s":""," selected"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(N,{variant:"outline",onClick:()=>w(!1),children:"Cancel"}),e.jsx(N,{onClick:Y,disabled:d===0||_,children:_?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"w-4 h-4 mr-2 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),"Generate ",d," Certificate",d!==1?"s":""]})})]})]})})]})})]})]})}export{Ze as default};
